# Features

## Feature List

### Core Features (Must Have)

| ID | 機能名 | 説明 | 関連US | ステータス |
|----|--------|------|--------|-----------|
| F-001 | 曖昧性検出エンジン | レポートから5パターンの曖昧性を検出 | US-001, US-002 | ✅ 仕様承認済 |
| F-002 | 品質スコア算出 | 検出結果から品質スコア(0-100)を算出 | US-003 | Planning |
| F-003 | 改善提案生成 | 検出した曖昧性に対する具体的な改善案を生成 | US-004 | Planning |
| F-004 | レポートエディター | レポートの作成・編集画面 | US-005 | Planning |

### Important Features (Should Have)

| ID | 機能名 | 説明 | 関連US | ステータス |
|----|--------|------|--------|-----------|
| F-010 | リアルタイム検出 | 入力中にリアルタイムで曖昧性を検出 | US-006 | Backlog |
| F-011 | ダッシュボード | 全レポートのサマリ・品質推移表示 | US-007 | Backlog |
| F-012 | チーム管理 | チームメンバーの管理・権限設定 | US-008 | Backlog |

### Nice to Have (Could Have)

| ID | 機能名 | 説明 | 関連US | ステータス |
|----|--------|------|--------|-----------|
| F-020 | Google Docs連携 | Google Docsからレポートをインポート | US-010 | Backlog |
| F-021 | Google Slides連携 | Google Slidesからレポートをインポート | US-010 | Backlog |
| F-022 | Notion連携 | Notionからレポートをインポート | US-010 | Backlog |
| F-023 | Slack通知 | 検出結果・リマインドをSlackに通知 | US-011 | Backlog |
| F-024 | KPIツリー表示 | 組織のKPIツリーを可視化 | US-012 | Backlog |

### Won't Have (This Phase)

| ID | 機能名 | 理由 |
|----|--------|------|
| F-X01 | 自動レポート生成 | MVP後に検討（Phase 3以降） |
| F-X02 | Google Chat監視 | リアルタイム介入は技術・UX検証後 |
| F-X03 | 多言語対応 | 日本語のみでMVP検証 |

---

## Feature Details

### F-001: 曖昧性検出エンジン

**概要:**
週次レポート・定例資料から曖昧性パターンを検出するコアエンジン。5つのパターンを検出し、それぞれに重要度（Critical/Warning/Info）を付与する。

**検出パターン:**

| コード | パターン名 | 検出難易度 |
|--------|-----------|-----------|
| FI | Fact/Interpretation Mixing（事実と解釈の混在） | Medium |
| LQ | Lack of Quantification（定量性不足） | Easy |
| UA | Unclear Action（行動不明確） | Easy |
| SA | Shallow Analysis（深掘り不足） | Hard |
| MC | Missing Coverage（網羅性不足） | Hard |

**ユーザーフロー:**
1. ユーザーがレポートを入力/インポート
2. システムが曖昧性検出を実行
3. 検出結果がサイドパネルに表示
4. ユーザーが各項目をクリックして詳細確認

**技術要件:**
- Vercel AI SDK + Claude API
- ストリーミングレスポンス（3秒以内に最初の結果表示）
- プロンプトは `lib/ai/prompts/audit.ts` で管理

**エッジケース:**
- 空のレポート: 「レポートが空です」とエラー表示
- 超長文レポート: 分割処理、進捗表示
- API障害: リトライ + エラーメッセージ

**依存関係:**
- 前提: なし（コア機能）
- 後続: F-002, F-003

**詳細仕様:** `02_product/features/audit-patterns.md` 参照

---

### F-002: 品質スコア算出

**概要:**
F-001の検出結果から品質スコア（0-100）を算出する。

**計算式:**
```
Quality Score = 100 - (Critical × 5 + Warning × 2 + Info × 1)
```

**スコア解釈:**

| スコア | 評価 | アクション |
|--------|------|-----------|
| 90-100 | Excellent | 承認可 |
| 70-89 | Good | 軽微な修正推奨 |
| 50-69 | Needs Improvement | 修正必須 |
| 0-49 | Poor | 再提出要求 |

**ユーザーフロー:**
1. F-001の検出完了後、自動でスコア算出
2. スコアとグレードをエディター上部に表示
3. スコアの内訳（パターン別）を展開可能

**UI/UX要件:**
- スコアは大きな数字で目立つ位置に表示
- 色分け: 緑(90+) / 黄(70-89) / オレンジ(50-69) / 赤(0-49)
- アニメーション: スコア算出時にカウントアップ

**技術要件:**
- クライアントサイドで計算（軽量）
- 検出結果のJSONからスコア算出

**依存関係:**
- 前提: F-001（検出結果）
- 後続: F-011（ダッシュボード）

---

### F-003: 改善提案生成

**概要:**
検出した曖昧性に対して、具体的な改善案（修正文）を生成する。

**ユーザーフロー:**
1. 検出項目をクリック
2. 「改善案を表示」ボタンをクリック
3. AIが改善案を生成・表示
4. 「適用」ボタンで本文に反映

**UI/UX要件:**
- 改善案は比較表示（Before / After）
- ワンクリックで適用
- 適用前にプレビュー可能

**技術要件:**
- Vercel AI SDK streamText
- 改善案生成用プロンプト
- 差分表示ライブラリ

**エッジケース:**
- 改善案が複数ある場合: 最大3つまで提示
- ユーザーが改善案を編集したい場合: 編集可能なテキストエリア

**依存関係:**
- 前提: F-001（検出結果）
- 後続: なし

---

### F-004: レポートエディター

**概要:**
レポートを作成・編集するメイン画面。曖昧性検出結果を右パネルに表示。

**画面構成:**
```
┌─────────────────────────────────────────────────────┐
│ [ヘッダー] レポートタイトル | 品質スコア | 保存    │
├────────────────────────────┬────────────────────────┤
│                            │                        │
│       エディター           │    検出結果パネル      │
│     （リッチテキスト）      │    - 問題一覧          │
│                            │    - 改善提案          │
│                            │    - スコア内訳        │
│                            │                        │
└────────────────────────────┴────────────────────────┘
```

**ユーザーフロー:**
1. レポート一覧から「新規作成」または既存レポートを選択
2. エディターでテキスト入力
3. 「検出実行」ボタンまたは自動検出
4. 右パネルで結果確認・改善
5. 「保存」で下書き保存、「提出」で確定

**UI/UX要件:**
- リッチテキストエディター（Markdown or WYSIWYG）
- 検出箇所のハイライト（クリックで詳細表示）
- オートセーブ（30秒間隔）
- キーボードショートカット

**技術要件:**
- TipTap or ProseMirror（エディター）
- shadcn/ui ResizablePanel（左右分割）
- Supabase Realtime（オートセーブ）

**エッジケース:**
- 複数タブで同時編集: 競合検知、マージUI
- ネットワーク切断: ローカル保存、再接続時同期

**依存関係:**
- 前提: F-001, F-002, F-003
- 後続: F-010（リアルタイム検出）

---

## Feature Flags

| フラグ名 | 機能 | 環境 | デフォルト |
|----------|------|------|-----------|
| `ENABLE_REALTIME_DETECTION` | リアルタイム検出 | Production | false |
| `ENABLE_GOOGLE_INTEGRATION` | Google連携 | Staging | false |
| `ENABLE_NOTION_INTEGRATION` | Notion連携 | Staging | false |

---

## Deprecated Features

| 機能名 | 廃止日 | 理由 | 移行先 |
|--------|--------|------|--------|
| - | - | - | - |

---

## Changelog

| 日付 | 変更内容 | 担当 |
|------|----------|------|
| 2026-01-23 | 初版作成（F-001〜F-024） | AI |

---

*最終更新: 2026-01-23*
